generator client {
  provider = "prisma-client-js"
  engineType    = "library"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Users {
  id           String       @id @default(uuid())
  name         String       @db.VarChar(250)
  username     String       @unique @db.VarChar(50)
  email        String       @unique @db.VarChar(100)
  region       String?      @db.VarChar(100)
  sex          String?       @db.VarChar(10)
  password     String       @db.VarChar(100)
  profileImage String?      @map("profile_image") @db.VarChar(255)
  createdAt    DateTime     @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt    DateTime     @updatedAt @map("updated_at") @db.Timestamp(6)
  spotChecks   SpotCheck[]
  chats        Chats[]
  ownedRooms   RoomChat[]    @relation("RoomChatCreatedBy")
  rooms        RoomParticipants[]
  @@map("users")
}

model Chats{
  id          String      @id @default(uuid())
  roomId      String      @map("room_id")
  senderId    String      @map("sender_id")
  message     String      @db.Text
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")
  roomChat    RoomChat    @relation(fields: [roomId], references: [id], onDelete: Cascade, map: "chats_room_chat_id_fkey")
  sender      Users       @relation(fields: [senderId], references: [id], onDelete: Cascade, map: "chats_sender_id_fkey")

  @@map("chats")
}

model RoomParticipants{
  id          String      @id @default(uuid())
  roomId      String      @map("room_id")
  userId      String      @map("user_id")
  joinedAt    DateTime    @default(now()) @map("joined_at")
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")
  roomChat    RoomChat    @relation(fields: [roomId], references: [id], onDelete: Cascade, map: "room_participants_room_id_fkey")
  user        Users       @relation(fields: [userId], references: [id], onDelete: Cascade, map: "room_participants_user_id_fkey")

  @@unique([userId, roomId], name: "unique_user_room")
  @@map("room_participants")
}

model RoomChat {
  id            String      @id @default(uuid())
  name          String      @db.VarChar(100)
  profileImage  String?     @map("profile_image") @db.VarChar(255)
  maxMember     Int         @map("max_member") @default(10)
  createdById   String      @map("created_by_id")
  createdAt     DateTime    @default(now()) @map("created_at")
  updatedAt     DateTime    @updatedAt @map("updated_at")
  createdBy     Users       @relation("RoomChatCreatedBy",fields: [createdById], references: [id], onDelete: Cascade, map: "room_chat_created_by_id_fkey")
  chats         Chats[]
  participants  RoomParticipants[]

  @@map("room_chat")
}

model CoffeeSpot {
  id         String      @id @default(uuid())
  name       String      @db.VarChar(100)
  address    String?     @db.Text
  urlAddress String?     @map("url_address") @db.VarChar(255)
  urlBlog    String?     @map("url_blog") @db.VarChar(255)
  image      String?     @db.VarChar(255)
  contact    String?     @db.VarChar(20)
  createdAt  DateTime    @default(now()) @map("created_at")
  updatedAt  DateTime    @updatedAt @map("updated_at")
  spotChecks SpotCheck[]

  @@map("coffee_spot")
}

model SpotCheck {
  id        String    @id @default(uuid())
  spotId    String    @map("spot_id")
  userId    String    @map("user_id")
  lastVisit DateTime  @map("last_visit")
  checkNum  Int       @map("check_num") @default(1)
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  spot      CoffeeSpot @relation(fields: [spotId], references: [id], onDelete: Cascade, map: "spot_check_spot_id_fkey")
  user      Users     @relation(fields: [userId], references: [id], onDelete: Cascade, map: "spot_check_user_id_fkey")

  @@map("spot_check")
}
